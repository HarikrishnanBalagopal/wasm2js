(()=>{"use strict";var __webpack_modules__={735:(t,e,n)=>{n.d(e,{GI:()=>p,IV:()=>o,Io:()=>_,KG:()=>r,S1:()=>i,di:()=>s,hM:()=>c,mm:()=>a});const o=65536,s="__my_wasm2js_helper_ctz",_=2n**64n,a=2n**63n-1n,r=-(2n**63n),c=2**32,i=2**31-1,p=-(2**31)},294:(t,e,n)=>{n.d(e,{$fu:()=>me,A18:()=>ae,AI0:()=>w,ARc:()=>le,ASf:()=>tt,B2e:()=>d,BF8:()=>Nt,BKh:()=>z,BLP:()=>ce,BUN:()=>kt,BWM:()=>b,BaX:()=>oe,Biz:()=>Pt,C0O:()=>k,D2H:()=>p,DG6:()=>et,DGE:()=>Mt,DLN:()=>N,E2D:()=>Tt,E9R:()=>O,FPU:()=>f,FUF:()=>i,FZV:()=>ie,GTH:()=>de,HQ9:()=>Ct,Ht0:()=>ut,IC6:()=>y,INI:()=>_e,Io8:()=>v,JV_:()=>Ft,JWo:()=>l,LR3:()=>ct,M5W:()=>q,MZn:()=>Z,MbB:()=>I,N16:()=>V,NI5:()=>zt,N_O:()=>Bt,Okp:()=>vt,OrZ:()=>ht,OyQ:()=>_,Pet:()=>u,R$M:()=>h,Rb8:()=>m,S$1:()=>nt,S1M:()=>jt,TGZ:()=>G,U7s:()=>Et,VDo:()=>re,VU1:()=>s,VdM:()=>pe,Vs6:()=>W,WB$:()=>ft,WD6:()=>U,WHI:()=>dt,Wyh:()=>ot,XPn:()=>xt,XQI:()=>$,Xmz:()=>st,Y1B:()=>Jt,Z9l:()=>Rt,ZCU:()=>S,Zn2:()=>At,_oO:()=>a,aX5:()=>ue,bel:()=>R,bnA:()=>wt,c$W:()=>se,c2P:()=>_t,c3i:()=>B,c4P:()=>J,c5S:()=>bt,c6J:()=>Xt,cJk:()=>yt,cYj:()=>Lt,dCg:()=>D,eSJ:()=>Dt,epn:()=>ee,fL7:()=>pt,f_T:()=>Ut,flZ:()=>Y,g$0:()=>A,gEx:()=>it,geW:()=>j,hOc:()=>X,j8l:()=>P,jPL:()=>Qt,jZd:()=>It,kJE:()=>c,kP0:()=>gt,kXX:()=>K,kXk:()=>Ht,kgi:()=>Gt,krz:()=>ne,lSp:()=>F,mJg:()=>rt,mgx:()=>$t,pO0:()=>Ot,pXG:()=>T,qHj:()=>C,qso:()=>o,r6g:()=>H,rEk:()=>Yt,rdx:()=>x,tNe:()=>r,tzH:()=>Vt,uPd:()=>Zt,ucY:()=>te,umX:()=>Wt,vTZ:()=>qt,vgP:()=>mt,wNn:()=>L,xJo:()=>g,ylT:()=>E,yq1:()=>St,z$P:()=>lt,zDl:()=>Kt,zco:()=>M,zqM:()=>at,zvM:()=>Q});const o=64,s=0,_=1,a=2,r=3,c=4,i=5,p=11,l=12,u=13,d=14,m=15,h=16,E=26,f=27,I=32,g=33,b=34,O=35,k=36,y=40,D=41,x=42,M=44,w=45,R=46,P=47,T=53,A=54,U=55,L=56,C=58,B=59,v=62,j=65,K=66,W=67,F=68,S=69,$=70,N=71,V=72,G=73,J=74,H=75,q=76,z=77,X=78,Z=79,Y=80,Q=81,tt=82,et=92,nt=93,ot=94,st=95,_t=96,at=104,rt=106,ct=107,it=108,pt=109,lt=110,ut=111,dt=112,mt=113,ht=114,Et=115,ft=116,It=117,gt=118,bt=119,Ot=122,kt=123,yt=124,Dt=125,xt=126,Mt=131,wt=132,Rt=133,Pt=134,Tt=135,At=136,Ut=139,Lt=140,Ct=142,Bt=143,vt=145,jt=146,Kt=147,Wt=148,Ft=149,St=150,$t=151,Nt=152,Vt=158,Gt=162,Jt=167,Ht=168,qt=169,zt=171,Xt=173,Zt=178,Yt=179,Qt=192,te=252,ee=0,ne=1,oe=2,se=3,_e=4,ae=5,re=6,ce=7,ie=8,pe=9,le=10,ue=11,de=253,me=Object.fromEntries(Object.entries({I_UNREACHABLE:0,I_NOP:1,I_BLOCK:2,I_LOOP:3,I_IF:4,I_ELSE:5,I_END:11,I_BR:12,I_BR_IF:13,I_BR_TABLE:14,I_RETURN:15,I_CALL:16,I_CALL_INDIRECT:17,I_DROP:26,I_SELECT:27,I_SELECT_TYPED:28,I_LOCAL_GET:32,I_LOCAL_SET:33,I_LOCAL_TEE:34,I_GLOBAL_GET:35,I_GLOBAL_SET:36,I_I32_LOAD:40,I_I64_LOAD:41,I_F32_LOAD:42,I_F64_LOAD:43,I_I32_LOAD_8_S:44,I_I32_LOAD_8_U:45,I_I32_LOAD_16_S:46,I_I32_LOAD_16_U:47,I_I64_LOAD_8_S:48,I_I64_LOAD_8_U:49,I_I64_LOAD_16_S:50,I_I64_LOAD_16_U:51,I_I64_LOAD_32_S:52,I_I64_LOAD_32_U:53,I_I32_STORE:54,I_I64_STORE:55,I_F32_STORE:56,I_F64_STORE:57,I_I32_STORE_8:58,I_I32_STORE_16:59,I_I64_STORE_8:60,I_I64_STORE_16:61,I_I64_STORE_32:62,I_MEMORY_SIZE:63,I_MEMORY_GROW:64,I_I32_CONST:65,I_I64_CONST:66,I_F32_CONST:67,I_F64_CONST:68,I_I32_EQZ:69,I_I32_EQ:70,I_I32_NE:71,I_I32_LT_S:72,I_I32_LT_U:73,I_I32_GT_S:74,I_I32_GT_U:75,I_I32_LE_S:76,I_I32_LE_U:77,I_I32_GE_S:78,I_I32_GE_U:79,I_I64_EQZ:80,I_I64_EQ:81,I_I64_NE:82,I_I64_LT_S:83,I_I64_LT_U:84,I_I64_GT_S:85,I_I64_GT_U:86,I_I64_LE_S:87,I_I64_LE_U:88,I_I64_GE_S:89,I_I64_GE_U:90,I_F32_EQ:91,I_F32_NE:92,I_F32_LT:93,I_F32_GT:94,I_F32_LE:95,I_F32_GE:96,I_F64_EQ:97,I_F64_NE:98,I_F64_LT:99,I_F64_GT:100,I_F64_LE:101,I_F64_GE:102,I_I32_CLZ:103,I_I32_CTZ:104,I_I32_POPCNT:105,I_I32_ADD:106,I_I32_SUB:107,I_I32_MUL:108,I_I32_DIV_S:109,I_I32_DIV_U:110,I_I32_REM_S:111,I_I32_REM_U:112,I_I32_AND:113,I_I32_OR:114,I_I32_XOR:115,I_I32_SHL:116,I_I32_SHR_S:117,I_I32_SHR_U:118,I_I32_ROTL:119,I_I32_ROTR:120,I_I64_CLZ:121,I_I64_CTZ:122,I_I64_POPCNT:123,I_I64_ADD:124,I_I64_SUB:125,I_I64_MUL:126,I_I64_DIV_S:127,I_I64_DIV_U:128,I_I64_REM_S:129,I_I64_REM_U:130,I_I64_AND:131,I_I64_OR:132,I_I64_XOR:133,I_I64_SHL:134,I_I64_SHR_S:135,I_I64_SHR_U:136,I_I64_ROTL:137,I_I64_ROTR:138,I_F32_ABS:139,I_F32_NEG:140,I_F32_CEIL:141,I_F32_FLOOR:142,I_F32_TRUNC:143,I_F32_NEAREST:144,I_F32_SQRT:145,I_F32_ADD:146,I_F32_SUB:147,I_F32_MUL:148,I_F32_DIV:149,I_F32_MIN:150,I_F32_MAX:151,I_F32_COPYSIGN:152,I_F64_ABS:153,I_F64_NEG:154,I_F64_CEIL:155,I_F64_FLOOR:156,I_F64_TRUNC:157,I_F64_NEAREST:158,I_F64_SQRT:159,I_F64_ADD:160,I_F64_SUB:161,I_F64_MUL:162,I_F64_DIV:163,I_F64_MIN:164,I_F64_MAX:165,I_F64_COPYSIGN:166,I_I32_WRAP_I64:167,I_I32_TRUNC_F32_S:168,I_I32_TRUNC_F32_U:169,I_I32_TRUNC_F64_S:170,I_I32_TRUNC_F64_U:171,I_I64_EXTEND_I32_S:172,I_I64_EXTEND_I32_U:173,I_I64_TRUNC_F32_S:174,I_I64_TRUNC_F32_U:175,I_I64_TRUNC_F64_S:176,I_I64_TRUNC_F64_U:177,I_F32_CONVERT_I32_S:178,I_F32_CONVERT_I32_U:179,I_I32_EXTEND_8_S:192}).map((([t,e])=>[e,t])))},451:(t,e,n)=>{var o,s;n.d(e,{Ge:()=>o}),function(t){t[t.I32=127]="I32",t[t.I64=126]="I64",t[t.F32=125]="F32",t[t.F64=124]="F64",t[t.V128=123]="V128",t[t.FuncRef=112]="FuncRef",t[t.ExternRef=111]="ExternRef"}(o||(o={})),Object.fromEntries(Object.entries({I32:127,I64:126,F32:125,F64:124,V128:123,FuncRef:112,ExternRef:111}).map((([t,e])=>[e,t]))),function(t){t[t.VALUE=0]="VALUE",t[t.LABEL=1]="LABEL",t[t.FRAME=2]="FRAME"}(s||(s={}))},148:(t,e,n)=>{n.d(e,{G:()=>o});const o=t=>JSON.stringify(t,((t,e)=>"bigint"==typeof e?e.toString():e))},341:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{PF:()=>compileAot,r9:()=>instantiateAot});var _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(294),_types_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(769),_common_constants_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(735),_common_utils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(148),_common_types_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(451),_parser_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(472);const newCompilationContext=()=>({newId:0,func_type_idx:-1,funcs:[],types:[],stack:[]}),range=t=>[...Array(t).keys()],my_stringify=t=>JSON.stringify(t,((t,e)=>"bigint"==typeof e?e.toString():e)),compileAotHelper=async(t,e,n=!1,o=!1)=>{n&&console.log("DEBUG compileAotHelper called with ctx:",JSON.stringify(t),"and body:",e);const s=[];for(let _ of e){if(n){const t=_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.$fu[_.opCode];console.log("compiling inst:",_,t);const e="data"in _?" "+my_stringify(_.data).slice(0,64):"";s.push(`// opcode: ${_.opCode} ${t}${e}`)}switch(_.opCode){case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.VU1:s.push('throw new Error("unreachable code");');break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.OyQ:break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__._oO:{n&&console.log("DEBUG block",_.data);const e=_.data;if(e.blockType!==_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.qso){if(e.blockType===_common_types_js__WEBPACK_IMPORTED_MODULE_2__.Ge.I32){console.log("Warning: SPECIAL CASE of I32 block type");const _="block_with_result_"+t.newId++;t.stack.push({is_loop:!1,label:_});const a=await compileAotHelper(t,e.body,n,o);s.push(`${_}: {`),s.push(...a.map((t=>"    "+t))),s.push("}");break}throw new Error("TODO: implement non-empty block type")}const a="block_"+t.newId++;t.stack.push({is_loop:!1,label:a});const r=await compileAotHelper(t,e.body,n,o);s.push(`${a}: {`),s.push(...r.map((t=>"    "+t))),s.push("}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.tNe:{n&&console.log("DEBUG loop",_.data);const e=_.data;if(e.blockType!==_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.qso)throw new Error("TODO: implement non-empty loop type");const a="loop_"+t.newId++;t.stack.push({is_loop:!0,label:a});const r=await compileAotHelper(t,e.body,n,o);s.push(`${a}: while (true) {`),s.push(...r.map((t=>"    "+t))),s.push(`    break ${a};`,"}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.kJE:{const e=_.data,a="if_"+t.newId++;t.stack.push({is_loop:!1,label:a}),s.push(`${a}: if (stack.pop() !== 0) {`);const r=await compileAotHelper(t,e.trueBody,n,o);if(s.push(...r.map((t=>"    "+t))),e.falseBody){s.push("} else {");const _=await compileAotHelper(t,e.falseBody,n,o);s.push(..._.map((t=>"    "+t)))}s.push("}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.FUF:break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.D2H:if(n&&console.log("DEBUG I_END >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> stack:",JSON.stringify(t.stack)),0===t.stack.length)throw new Error("trying to I_END with an empty stack");t.stack.pop(),n&&console.log("stack:",JSON.stringify(t.stack));break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.JWo:{n&&console.log("I_BR inst",_,"stack",JSON.stringify(t.stack));const e=_.data;if(0===t.stack.length)throw n&&console.log("I_BR inst",_),new Error("trying to br with an empty stack");const o=t.stack.length-1-e,a=t.stack[o];if(0===o){console.log("I_BR break to a function instead of a block or loop, target:",a);const e=t.types[t.func_type_idx];0===e.results.length?s.push("return;"):1===e.results.length?s.push("return stack.pop();"):s.push(`return stack.slice(-${e.results.length});`);break}s.push(`${a.is_loop?"continue":"break"} ${a.label};`);break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Pet:{n&&console.log("I_BR_IF inst",_,"stack",JSON.stringify(t.stack));const e=_.data;if(0===t.stack.length)throw n&&console.log("I_BR_IF inst",_),new Error("trying to br_if with an empty stack");const o=t.stack.length-1-e,a=t.stack[o];if(0===o){n&&console.log("I_BR_IF break (conditional) to a function instead of a block or loop, target:",a);const e=t.types[t.func_type_idx];0===e.results.length?s.push("if (stack.pop() !== 0) { return; }"):1===e.results.length?s.push("if (stack.pop() !== 0) { return stack.pop(); }"):s.push(`if (stack.pop() !== 0) { return stack.slice(-${e.results.length}); }`);break}s.push(`if (stack.pop() !== 0) { ${a.is_loop?"continue":"break"} ${a.label}; }`);break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.B2e:{const e=_.data;if(n&&console.log("I_BR_TABLE instData:",e),e.def>=t.stack.length)throw new Error("not enough stack elements for def branch");if(Math.max(...e.branches)>=t.stack.length)throw new Error("not enough stack elements for the various branch");if(0===e.branches.length){n&&console.log("DEBUG: I_BR_TABLE with only a default branch");const o=t.stack[t.stack.length-1-e.def];s.push("stack.pop();",`${o.is_loop?"continue":"break"} ${o.label};`);break}n&&console.log("DEBUG: I_BR_TABLE with multiple branches and a default branch"),s.push("{","    const target_idx = stack.pop();");for(let n=0;n<e.branches.length;n++){const o=e.branches[n],_=t.stack[t.stack.length-1-o];0===n?s.push(`    if(target_idx === ${n}) { ${_.is_loop?"continue":"break"} ${_.label}; }`):s.push(`    else if(target_idx === ${n}) { ${_.is_loop?"continue":"break"} ${_.label}; }`)}const o=t.stack[t.stack.length-1-e.def];s.push(`    else { ${o.is_loop?"continue":"break"} ${o.label}; }`,"}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Rb8:{const e=t.types[t.func_type_idx];if(0===e.results.length){s.push("return;");break}if(1===e.results.length){s.push("return stack.pop();");break}s.push(`return stack.slice(-${e.results.length});`);break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.R$M:{n&&console.log("I_CALL",_,"ctx:",JSON.stringify(t));const e=_.data;if(e>=t.funcs.length)throw new Error("function index is outside the range of the funcs array");const o=t.funcs[e];if(o>=t.types.length)throw new Error("function type index is outside the range of the types array");const a=t.types[o];if(n&&console.log("I_CALL calling a function of funcIdx",e," func_type_idx",o," func_type",a),0===a.params.length&&0===a.results.length){s.push(`func${e}();`);break}if(0===a.params.length){1===a.results.length?s.push(`stack.push(func${e}());`):s.push(`stack.push(...func${e}());`);break}if(0===a.results.length){1===a.params.length?s.push(`func${e}(stack.pop());`):s.push("{",`    const args = stack.slice(-${a.params.length});`,...range(a.params.length).map((()=>"    stack.pop();")),`    func${e}(...args);`,"}");break}1===a.results.length?1===a.params.length?s.push(`stack.push(func${e}(stack.pop()));`):s.push("{",`    const args = stack.slice(-${a.params.length});`,...range(a.params.length).map((()=>"    stack.pop();")),`    const result = func${e}(...args);`,"    stack.push(result);","}"):1===a.params.length?s.push(`stack.push(...func${e}(stack.pop()));`):s.push("{",`    const args = stack.slice(-${a.params.length});`,...range(a.params.length).map((()=>"    stack.pop();")),`    stack.push(...func${e}(...args));`,"}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.ylT:s.push("stack.pop();");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.FPU:s.push("{","    const condition = stack.pop();","    const x2 = stack.pop();","    const x1 = stack.pop();","    stack.push(condition !== 0 ? x1 : x2);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.MbB:s.push(`stack.push(local${_.data});`);break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.xJo:s.push("{"),s.push(`    local${_.data} = stack.pop();`),s.push(`    if(local${_.data} < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) throw new Error('I_LOCAL_SET DEBUG local${_.data} less than most negative');`),s.push("}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.BWM:s.push(`local${_.data} = stack[stack.length - 1];`);break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.E9R:s.push("{"),s.push(`    const g = global${_.data};`),s.push("    stack.push(g);"),s.push(`    if(g < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) throw new Error('I_GLOBAL_GET g less than most negative');`),s.push("}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.C0O:s.push(`global${_.data} = stack.pop();`);break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.IC6:{const t=_.data;s.push(`stack.push(new DataView(memory0.buffer, ${t.offset} + stack.pop(), 4).getInt32(0, true));`);break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.dCg:{const t=_.data;s.push(`stack.push(new DataView(memory0.buffer, ${t.offset} + stack.pop(), 8).getBigInt64(0, true));`);break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.rdx:{const t=_.data;s.push("{"),s.push("    const x = stack.pop();"),s.push(`    const o = ${t.offset};`),s.push("    try {"),s.push("        stack.push(new DataView(memory0.buffer, o + x, 4).getFloat32(0, true));"),s.push("    } catch(e) {"),s.push('        throw new Error("DEBUG getFloat32");'),s.push("    }"),s.push("}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.zco:{const t=_.data;s.push(`stack.push(new DataView(memory0.buffer, ${t.offset} + stack.pop(), 1).getInt8(0));`);break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.AI0:{const t=_.data;s.push(`stack.push(new DataView(memory0.buffer, ${t.offset} + stack.pop(), 1).getUint8(0));`);break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.bel:{const t=_.data;s.push(`stack.push(new DataView(memory0.buffer, ${t.offset} + stack.pop(), 2).getInt16(0, true));`);break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.j8l:{const t=_.data;s.push(`stack.push(new DataView(memory0.buffer, ${t.offset} + stack.pop(), 2).getUint16(0, true));`);break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.pXG:{const t=_.data;s.push(`stack.push(BigInt(new DataView(memory0.buffer, ${t.offset} + stack.pop(), 4).getUint32(0, true)));`);break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.g$0:{const t=_.data;s.push("{","    const x = stack.pop();","    const a = stack.pop();",`    const offset = ${t.offset};`,"    const address = offset + a;","    if (address < 0) {",'        console.error("I_I32_STORE DEBUG a", a, "offset", offset, "address", address);',"        debugger;",'        throw new Error("I_I32_STORE the address is negative");',"    }","    new DataView(memory0.buffer, address, 4).setInt32(0, x, true);","}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.WD6:{const t=_.data;s.push("{","    const x = stack.pop();",`    new DataView(memory0.buffer, ${t.offset} + stack.pop(), 8).setBigUint64(0, BigInt(x), true);`,"}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.wNn:{const t=_.data;s.push("{","    const x = stack.pop();",`    new DataView(memory0.buffer, ${t.offset} + stack.pop(), 4).setFloat32(0, x, true);`,"}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.qHj:{const t=_.data;s.push("{","    const x = stack.pop();",`    memory0[${t.offset} + stack.pop()] = x;`,"}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.c3i:{const t=_.data;s.push("{","    const x = stack.pop();",`    new DataView(memory0.buffer, ${t.offset} + stack.pop(), 2).setInt16(0, x, true);`,"}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Io8:{const t=_.data;s.push("{","    const x = Number(stack.pop() & 0xFFFFFFFFn);",`    new DataView(memory0.buffer, ${t.offset} + stack.pop(), 4).setInt32(0, x, true);`,"}");break}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.geW:s.push(`stack.push(${_.data});`);break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.kXX:s.push(`stack.push(${_.data}n);`);break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Vs6:case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.lSp:s.push(`stack.push(${_.data});`);break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.ZCU:s.push("stack.push(stack.pop() === 0 ? 1 : 0);");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.XQI:s.push("stack.push(stack.pop() === stack.pop() ? 1 : 0);");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.DLN:s.push("stack.push(stack.pop() !== stack.pop() ? 1 : 0);");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.N16:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() < x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.TGZ:o?s.push("{","    const y = BigInt.asUintN(32, BigInt(stack.pop()));","    const x = BigInt.asUintN(32, BigInt(stack.pop()));","    stack.push(x < y ? 1 : 0);","}"):s.push("{","    const x = stack.pop();","    stack.push(stack.pop() < x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.c4P:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() > x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.r6g:o?s.push("{","    const y = BigInt.asUintN(32, BigInt(stack.pop()));","    const x = BigInt.asUintN(32, BigInt(stack.pop()));","    stack.push(x > y ? 1 : 0);","}"):s.push("{","    const x = stack.pop();","    stack.push(stack.pop() > x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.M5W:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() <= x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.BKh:o?s.push("{","    const y = BigInt.asUintN(32, BigInt(stack.pop()));","    const x = BigInt.asUintN(32, BigInt(stack.pop()));","    stack.push(x <= y ? 1 : 0);","}"):s.push("{","    const x = stack.pop();","    stack.push(stack.pop() <= x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.hOc:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() >= x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.MZn:o?s.push("{","    const y = BigInt.asUintN(32, BigInt(stack.pop()));","    const x = BigInt.asUintN(32, BigInt(stack.pop()));","    stack.push(x >= y ? 1 : 0);","}"):s.push("{","    const x = stack.pop();","    stack.push(stack.pop() >= x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.flZ:s.push("stack.push(stack.pop() === 0n ? 1 : 0);");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.zvM:s.push("stack.push(stack.pop() === stack.pop() ? 1 : 0);");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.ASf:case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.DG6:s.push("stack.push(stack.pop() !== stack.pop() ? 1 : 0);");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.S$1:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() < x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Wyh:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() > x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Xmz:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() <= x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.c2P:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() >= x ? 1 : 0);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.zqM:s.push(`stack.push(${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.di}(stack.pop(), false));`);break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.mJg:s.push("{","    const y = stack.pop();","    const x = stack.pop();","    const sp_x = x + y;",`    const sp_x_1 = (sp_x < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.GI}) ? (sp_x + ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.hM}) : sp_x;`,`    const sp_x_2 = (sp_x_1 > ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.S1}) ? (sp_x_1 - ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.hM}) : sp_x_1;`,"    stack.push(sp_x_2);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.LR3:s.push("{","    const x = stack.pop();","    const sp_x = stack.pop() - x;",`    const sp_x_1 = (sp_x < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.GI}) ? (sp_x + ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.hM}) : sp_x;`,`    const sp_x_2 = (sp_x_1 > ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.S1}) ? (sp_x_1 - ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.hM}) : sp_x_1;`,"    stack.push(sp_x_2);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.gEx:s.push("{","    const sp_x = Number(BigInt.asIntN(32, BigInt(stack.pop() * stack.pop())));",`    const sp_x_1 = (sp_x < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.GI}) ? (sp_x + ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.hM}) : sp_x;`,`    const sp_x_2 = (sp_x_1 > ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.S1}) ? (sp_x_1 - ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.hM}) : sp_x_1;`,"    stack.push(sp_x_2);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.fL7:o?s.push("{","    const y = BigInt.asIntN(32, BigInt(stack.pop()));","    const x = BigInt.asIntN(32, BigInt(stack.pop()));","    stack.push(Number(x / y));","}"):s.push("{","    const x = stack.pop();","    stack.push(Math.trunc(stack.pop() / x));","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.z$P:o?s.push("{","    const y = BigInt.asUintN(32, BigInt(stack.pop()));","    const x = BigInt.asUintN(32, BigInt(stack.pop()));","    stack.push(Number(x / y));","}"):s.push("{","    const x = stack.pop();","    stack.push(Math.trunc(stack.pop() / x));","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Ht0:case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.WHI:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() % x);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.vgP:s.push("stack.push(stack.pop() & stack.pop());");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.OrZ:s.push("stack.push(stack.pop() | stack.pop());");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.U7s:o?s.push("const x2 = Number(BigInt.asUintN(32, BigInt(stack.pop())));","const x1 = Number(BigInt.asUintN(32, BigInt(stack.pop())));","stack.push(x1 ^ x2);"):s.push("stack.push(stack.pop() ^ stack.pop());");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.WB$:s.push("{","    const x = stack.pop();","    stack.push((stack.pop() << x) & 0xFFFFFFFF);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.jZd:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() >> x);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.kP0:s.push("{","    const by = stack.pop();","    const value = stack.pop();","    const shifted = value >>> by;","    stack.push(shifted);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.c5S:s.push("{","    const x = stack.pop();","    const v = stack.pop();","    stack.push((v << x) | (v >>> (32-x)));","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.pO0:s.push(`stack.push(BigInt(${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.di}(stack.pop(), true)));`);break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.BUN:s.push('stack.push(BigInt(BigInt.asUintN(64, stack.pop()).toString(2).split("").filter(x => x==="1").length));');break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.cJk:s.push("{","    const sp_x = stack.pop() + stack.pop();",`    const sp_x_1 = (sp_x < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) ? (sp_x + ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.Io}n) : sp_x;`,`    const sp_x_2 = (sp_x_1 > ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.mm}n) ? (sp_x_1 - ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.Io}n) : sp_x_1;`,"    stack.push(sp_x_2);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.eSJ:s.push("{","    const x = stack.pop();","    const sp = stack.pop();","    const sp_x = sp - x;",`    const sp_x_1 = (sp_x < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) ? (sp_x + ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.Io}n) : sp_x;`,`    const sp_x_2 = (sp_x_1 > ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.mm}n) ? (sp_x_1 - ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.Io}n) : sp_x_1;`,"    stack.push(sp_x_2);",`    if(x < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) throw new Error('I_I64_SUB x less than most negative');`,`    if(sp < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) throw new Error('I_I64_SUB sp less than most negative');`,`    if(sp_x_2 < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) throw new Error('I_I64_SUB sp_x_2 less than most negative');`,"}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.XPn:s.push("{","    const sp_x = BigInt.asIntN(64, stack.pop() * stack.pop());",`    const sp_x_1 = (sp_x < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) ? (sp_x + ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.Io}n) : sp_x;`,`    const sp_x_2 = (sp_x_1 > ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.mm}n) ? (sp_x_1 - ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.Io}n) : sp_x_1;`,"    stack.push(sp_x_2);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.DGE:s.push("{"),s.push("    const y = stack.pop();"),s.push("    const x = stack.pop();"),s.push("    const z = x & y;"),s.push("    stack.push(z);"),s.push(`    if(x < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) throw new Error('I_I64_AND x less than most negative');`),s.push(`    if(y < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) throw new Error('I_I64_AND y less than most negative');`),s.push(`    if(z < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) throw new Error('I_I64_AND z less than most negative');`),s.push("}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.bnA:s.push("stack.push(stack.pop() | stack.pop());");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Z9l:s.push("{","    const x2 = BigInt.asUintN(64, stack.pop());","    const x1 = BigInt.asUintN(64, stack.pop());","    const x3 = x1 ^ x2;",`    if(x1 < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) throw new Error('I_I64_XOR x1 less than most negative');`,`    if(x2 < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) throw new Error('I_I64_XOR x2 less than most negative');`,`    if(x3 < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.KG}n) { console.log("I_I64_XOR x1", x1, "x2", x2, "x3", x3); throw new Error('I_I64_XOR x3 less than most negative'); }`,"    stack.push(x3);",'    if(x3 > 0xFFFFFFFFFFFFFFFFn) throw new Error("I_I64_XOR something is wrong");',"}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Biz:s.push("{","    const by = stack.pop();","    const value = stack.pop();","    const shifted = (value << by) & 0xFFFFFFFFFFFFFFFFn;","    stack.push(shifted);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.E2D:case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Zn2:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() >> x);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.f_T:s.push("stack.push(Math.abs(stack.pop()));");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.cYj:s.push("stack.push(-stack.pop());");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.HQ9:s.push("stack.push(Math.floor(stack.pop()));");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.N_O:s.push("stack.push(Math.trunc(stack.pop()));");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Okp:s.push("stack.push(Math.sqrt(stack.pop()));");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.S1M:s.push("stack.push(stack.pop() + stack.pop());");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.zDl:s.push("{","    const x = stack.pop();","    stack.push(stack.pop() - x);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.umX:s.push("stack.push(stack.pop() * stack.pop());");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.JV_:s.push("{","    const y = stack.pop();","    const x = stack.pop();","    const z = x / y;","    stack.push(z);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.yq1:s.push("{","    const x2 = stack.pop();","    const x1 = stack.pop();","    stack.push(x1 < x2 ? x1 : x2);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.mgx:s.push("{","    const x2 = stack.pop();","    const x1 = stack.pop();","    stack.push(x1 > x2 ? x1 : x2);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.BF8:s.push("{","    const x2 = stack.pop();","    const x1 = stack.pop();","    stack.push(((x1 >= 0 && x2 >= 0) || (x1 < 0 && x2 < 0)) ? x1 : -x1);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.tzH:s.push("stack.push(Math.round(stack.pop()));");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.kgi:s.push("stack.push(stack.pop() * stack.pop());");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Y1B:s.push("{","    const x = stack.pop();","    const y = BigInt.asIntN(32, x);","    const z = Number(y);","    stack.push(z);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.kXk:s.push("{","    const x = stack.pop();","    const y = Math.trunc(x);",'    if(!Number.isFinite(x)) throw new Error("I_I32_TRUNC_F32_S not finite");',`    if(x < ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.GI} || x > ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.S1}) throw new Error("I_I32_TRUNC_F32_S float unrepresentable in integer range");`,"    stack.push(y);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.vTZ:case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.NI5:s.push("{","    const x = stack.pop();","    const y = Math.trunc(x);",'    if(!Number.isFinite(x)) throw new Error("I_I32_TRUNC_F32_S not finite");',`    if(x < 0 || x > ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.S1}) throw new Error("I_I32_TRUNC_F32_S float unrepresentable in integer range");`,"    stack.push(y);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.c6J:s.push("{","    const x = stack.pop();","    const y = BigInt(x);","    const z = BigInt.asUintN(32, y);","    stack.push(z);","}");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.uPd:case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.rEk:break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.jPL:s.push("stack.push(Number(BigInt.asIntN(8, BigInt(stack.pop()))));");break;case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.ucY:{const t=_.data;if(console.log("TODO: I_VARIABLE_0XFC instData:",t),!Array.isArray(t)||0===t.length)throw new Error("invalid I_VARIABLE_0XFC");const e=t[0];if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.epn)throw new Error("TODO: implement I_I32_TRUNC_SAT_F32_S");if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.krz)throw new Error("TODO: implement I_I32_TRUNC_SAT_F32_U");if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.BaX)throw new Error("TODO: implement I_I32_TRUNC_SAT_F64_S");if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.c$W)throw new Error("TODO: implement I_I32_TRUNC_SAT_F64_U");if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.INI)throw new Error("TODO: implement I_I64_TRUNC_SAT_F32_S");if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.A18)throw new Error("TODO: implement I_I64_TRUNC_SAT_F32_U");if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.VDo)throw new Error("TODO: implement I_I64_TRUNC_SAT_F64_S");if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.BLP)throw new Error("TODO: implement I_I64_TRUNC_SAT_F64_U");if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.FZV)throw new Error("TODO: implement I_MEMORY_INIT");if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.VdM)throw new Error("TODO: implement I_DATA_DROP");if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.ARc)throw new Error("TODO: implement I_MEMORY_COPY");if(e===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.aX5){s.push("{","    const n = stack.pop();","    const value = stack.pop();","    const dest = stack.pop();","    memory0.fill(value, dest, dest + n);","}");break}throw new Error("TODO: implement I_VARIABLE_0XFC")}case _common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.GTH:throw new Error("TODO: implement I_VARIABLE_0XFD");default:throw s.push(`// TODO: unknown op code, cannot compile, inst: ${(0,_common_utils_js__WEBPACK_IMPORTED_MODULE_5__.G)(_)}`),new Error(`unknown op code, cannot compile, inst: ${(0,_common_utils_js__WEBPACK_IMPORTED_MODULE_5__.G)(_)}`)}}return s},compileAot=async(t,e=!1,n=!0)=>{e&&console.log("DEBUG compileAot called with wasmBytes:",t);const o=(0,_parser_js__WEBPACK_IMPORTED_MODULE_3__.l)(t);if(o.type!==_types_js__WEBPACK_IMPORTED_MODULE_1__.V8.RESULT)throw new Error(`parsing failed. ${(0,_common_utils_js__WEBPACK_IMPORTED_MODULE_5__.G)(o)}`);const s=o.result;e&&console.log("DEBUG ast:",s);const _=[],a=[`function ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.di}(x, i64) {`,"    const bwidth = i64 ? 64 : 32;",'    const s = BigInt.asUintN(bwidth, BigInt(x)).toString(2).padStart(bwidth, "0");',"    let count = 0;","    for (let i = s.length-1; i >= 0; i--, count++) {",'        if (s[i] !== "0") {',"            break;","        }","    }","    if(count < 0 || count > bwidth) {",'        console.error("x", x, "s", s, "count", count);','        throw new Error("DEBUG: CTZ count is incorrect");',"    }","    return count;","}"],r=s.imports.filter((t=>t.type===_types_js__WEBPACK_IMPORTED_MODULE_1__.VF.GLOBAL)),c=r.length;r.forEach(((t,e)=>{a.push(`if (!('${t.module}' in import_object) || !('${t.name}' in import_object['${t.module}'])) {`,`    throw new Error('failed to find the global import in the import object: ${t.module} ${t.name}');`,"}",`let global${e} = import_object['${t.module}']['${t.name}'];`)}));const i=s.imports.filter((t=>t.type===_types_js__WEBPACK_IMPORTED_MODULE_1__.VF.MEM));if(i.length>0){if(i.length>1)throw new Error("maximum one memory import is supported currently");const t=i[0];e&&console.log("DEBUG importedMemory",t),a.push(`if (!import_object['${t.module}'] || !import_object['${t.module}']['${t.name}']) {`,`    throw new Error('failed to find the memory import in the import object: ${t.module} ${t.name}');`,"}",`const memory0 = import_object['${t.module}']['${t.name}'];`)}const p=s.imports.filter((t=>t.type===_types_js__WEBPACK_IMPORTED_MODULE_1__.VF.FUNC)),l=p.map((t=>t.typeIdx)),u=p.length;e&&console.log("DEBUG importedFuncsTypeIdxs",l,"importedFuncsLength",u),p.forEach(((t,e)=>{a.push(`if (!import_object['${t.module}'] || !import_object['${t.module}']['${t.name}']) {`,`    throw new Error('failed to find the function import in the import object: ${t.module} ${t.name}');`,"}",`const func${e} = import_object['${t.module}']['${t.name}'];`)})),e&&console.log("DEBUG importJsCode",a),_.push(...a);const d=s.globals.map(((t,e)=>`${t.mut?"let":"const"} global${c+e} = ${(t=>{if(0===t.expr.length)return 0;if(2!==t.expr.length)throw new Error("bad expression");const e=t.expr[0];if(e.opCode===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.geW||e.opCode===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.kXX||e.opCode===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.Vs6||e.opCode===_common_instructions_js__WEBPACK_IMPORTED_MODULE_0__.lSp)return e.data;throw new Error("bad expression, invalid opCode")})(t)}${t.type===_common_types_js__WEBPACK_IMPORTED_MODULE_2__.Ge.I64?"n":""};`));_.push(...d);const m=s.mems.map(((t,e)=>`const memory${e} = new Uint8Array(${t.min} * ${_common_constants_js__WEBPACK_IMPORTED_MODULE_4__.IV});`));_.push(...m);const h=s.datas.map((t=>{if(e&&console.log("ast.datas.map(x",t),"active"!==t.type)throw new Error("TODO: support passive data sections");const n=t.offsetExpr[0].data;return`memory0.set([${t.data}], ${n});`}));e&&console.log("DEBUG dataJsCode",h),_.push(...h);for(let t=0;t<s.funcs.length;t++){const o=s.funcs[t],a=s.types[o],r=s.codes[t],c=r.locals.map(((t,e)=>`    let local${a.params.length+e} = ${t===_common_types_js__WEBPACK_IMPORTED_MODULE_2__.Ge.I64?"0n":"0"};`));e&&(console.log("----------------------------------------------"),console.log("DEBUG compiling function, i:",t,"func_type:",a,"code:",r));const i=[`function func${u+t}(${0===a.params.length?"":range(a.params.length).map((t=>`local${t}`)).join(", ")}) {`,"    const stack = [];",...c],p=newCompilationContext();p.func_type_idx=o,p.funcs=[...l,...s.funcs],p.types=s.types,p.stack.push({is_loop:!1,label:`top_level_func_${t}`});const d=await compileAotHelper(p,r.body,e,n);i.push(...d.map((t=>"    "+t))),a.results.length>0&&(1===a.results.length?i.push("    return stack.pop();"):i.push(`    return stack.slice(-${a.results.length});`)),i.push("}"),_.push(...i)}const E=["const wasmExports = {",...s.exports.filter((t=>t.type===_types_js__WEBPACK_IMPORTED_MODULE_1__.VF.FUNC)).map((t=>`    "${t.name}": func${t.idx},`)),...s.exports.filter((t=>t.type===_types_js__WEBPACK_IMPORTED_MODULE_1__.VF.MEM)).map((t=>`    "${t.name}": memory${t.idx},`)),"};"];return _.push(...E),s.start>=0&&_.push(`func${s.start}();`),"(function (import_object) {\n    "+_.join("\n    ")+"\n    return { exports: wasmExports };\n})"},instantiateAot=async(compiledJSCode,importObject)=>{const createInstance=eval(compiledJSCode);return createInstance(importObject)}},472:(t,e,n)=>{n.d(e,{l:()=>pt});const o=(t,e=!1)=>{if(0===t.length)throw new Error("the provided bytes is empty");const n=Array.from(t).map((t=>BigInt(127&t))).reverse();let o=0n;for(let t of n)o=128n*o+t;if(e&&0n!==n[0]){let t=o.toString(2);if(t.length%7!=0){const e=t.length+7-t.length%7;t=t.padStart(e,"0")}if("1"===t[0]){let t=1n;for(;t<o;)t*=128n;o=t-o,o=-o}}return o},s=(new TextEncoder,new TextDecoder);var _=n(294),a=n(451),r=n(769);const c=t=>e=>n=>{const o=e(n);return o.type===r.V8.ERROR?o:{type:r.V8.RESULT,rest:o.rest,result:t(o.result)}},i=(t,e)=>e=>e.length<1||e[0]!==t?{type:r.V8.ERROR,rest:e,error:[`${t}`,e]}:{type:r.V8.RESULT,rest:new Uint8Array(e.buffer,e.byteOffset+1),result:t},p=t=>e=>{if(e.length<t.length)return{type:r.V8.ERROR,rest:e,error:[JSON.stringify(t),e]};for(let n=0;n<t.length;n++)if(e[n]!==t[n])return{type:r.V8.ERROR,rest:e,error:[JSON.stringify(t),e]};return{type:r.V8.RESULT,rest:new Uint8Array(e.buffer,e.byteOffset+t.length),result:t}},l=t=>e=>n=>{for(let t of e){const e=t(n);if(e.type!==r.V8.ERROR)return e}return{type:r.V8.ERROR,rest:n,error:[t,n]}},u=t=>e=>{const n=[];let o=e;for(let e of t){const t=e(o);if(t.type===r.V8.ERROR)return t;n.push(t.result),o=t.rest}return{type:r.V8.RESULT,rest:o,result:n}},d=t=>e=>{const n=[];let o=e;for(;;){const e=t(o);if(e.type===r.V8.ERROR)return{type:r.V8.RESULT,rest:o,result:n};n.push(e.result),o=e.rest}},m=t=>e=>{const n=t(e);return n.type===r.V8.RESULT?n:{type:r.V8.RESULT,rest:e,result:null}},h=i(a.Ge.I32),E=i(a.Ge.I64),f=i(a.Ge.F32),I=i(a.Ge.F64),g=l("numtype")([h,E,f,I]),b=i(a.Ge.V128),O=l("vectype")([b]),k=i(a.Ge.FuncRef),y=i(a.Ge.ExternRef),D=l("reftype")([k,y]),x=l("valtype")([g,O,D]),M=t=>{if(0===t.length)return{type:r.V8.ERROR,rest:t,error:["u32",t]};const e=[];let n=0;for(;n<t.length&&n<5;n++)if(e.push(t[n]),0==(128&t[n])){n++;break}if(0!=(128&e[e.length-1]))return{type:r.V8.ERROR,rest:t,error:["u32",t]};const s=o(new Uint8Array(e),!1);return{type:r.V8.RESULT,rest:new Uint8Array(t.buffer,t.byteOffset+n),result:{type:"u32",value:s}}},w=t=>{if(0===t.length)return{type:r.V8.ERROR,rest:t,error:["i32",t]};const e=[];let n=0;for(;n<t.length&&n<5;n++)if(e.push(t[n]),0==(128&t[n])){n++;break}if(0!=(128&e[e.length-1]))return{type:r.V8.ERROR,rest:t,error:["i32",t]};const s=Number(o(new Uint8Array(e),!0));return{type:r.V8.RESULT,rest:new Uint8Array(t.buffer,t.byteOffset+n),result:{type:"i32",value:s}}},R=t=>e=>{const n=M(e);return n.type===r.V8.ERROR?n:Number(n.result.value)!==t?{type:r.V8.ERROR,rest:e,error:[`num u32 - ${t}`,e]}:{type:r.V8.RESULT,rest:n.rest,result:t}},P=t=>e=>{const n=M(e);return n.type===r.V8.ERROR?n:(o=Number(n.result.value),t=>e=>{const n=[];let s=e;for(let e=0;e<o;e++){const e=t(s);if(e.type===r.V8.ERROR)return e;n.push(e.result),s=e.rest}return{type:r.V8.RESULT,rest:s,result:n}})(t)(n.rest);var o},T=t=>{const e=M(t);if(e.type===r.V8.ERROR)return e;const n=Number(e.result.value);if(e.rest.length<n)return{type:r.V8.ERROR,rest:e.rest,error:["vec-bytes",e.rest]};const o=new Uint8Array(e.rest.buffer,e.rest.byteOffset,n),s=new Uint8Array(e.rest.buffer,e.rest.byteOffset+n);return{type:r.V8.RESULT,rest:s,result:o}},A=c((t=>s.decode(t)))(T),U=P(x),L=c((t=>({type:"functype",value:{params:t[1],results:t[2]}})))(u([i(96,"functype"),U,U])),C=c((t=>({type:"limits",value:{min:Number(t[1].value),max:Number(t[2]?.value)}})))(l("limits")([u([i(0,"limits"),M]),u([i(1,"limits-with-max"),M,M])])),B=C,v=u([D,C]),j=u([x,l("mut")([i(0,"const"),i(1,"var")])]),K=c((t=>Number(t.value)))(M),W=c((t=>({align:Number(t[0].value),offset:Number(t[1].value)})))(u([M,M])),F=c((t=>{if(Array.isArray(t)){if(2===t.length){const e=t[1];return"u32"===e.type||"i32"===e.type||"i64"===e.type||"f32"===e.type||"f64"===e.type?{opCode:t[0],data:e.value}:{opCode:t[0],data:t[1]}}return{opCode:t[0],data:t.slice(1)}}return{opCode:t}}))(l("plaininst")([i(_.VU1,"unreachable"),i(_.OyQ,"nop"),u([i(_.JWo,"br"),K]),u([i(_.Pet,"br_if"),K]),c((t=>[t[0],{branches:t[1],def:t[2]}]))(u([i(_.B2e,"br_table"),P(K),K])),i(15,"return"),u([i(_.R$M,"call"),K]),u([i(17,"call_indirect"),K,K]),u([i(208,"ref.null"),D]),i(209,"ref.is_null"),u([i(210,"ref.func"),K]),i(26,"drop"),i(27,"select"),u([i(28,"select"),P(x)]),u([i(_.MbB,"local.get"),K]),u([i(_.xJo,"local.set"),K]),u([i(_.BWM,"local.tee"),K]),u([i(35,"global.get"),K]),u([i(36,"global.set"),K]),u([i(37,"table.get"),K]),u([i(38,"table.set"),K]),u([i(252,"table.init"),R(12),K,K]),u([i(252,"elem.drop"),R(13),K]),u([i(252,"table.copy"),R(14),K,K]),u([i(252,"table.grow"),R(15),K]),u([i(252,"table.size"),R(16),K]),u([i(252,"table.fill"),R(17),K]),u([i(_.IC6,"i32.load"),W]),u([i(41,"i64.load"),W]),u([i(42,"f32.load"),W]),u([i(43,"f64.load"),W]),u([i(44,"i32.load8_s"),W]),u([i(_.AI0,"i32.load8_u"),W]),u([i(46,"i32.load16_s"),W]),u([i(_.j8l,"i32.load16_u"),W]),u([i(48,"i64.load8_s"),W]),u([i(49,"i64.load8_u"),W]),u([i(50,"i64.load16_s"),W]),u([i(51,"i64.load16_u"),W]),u([i(52,"i64.load32_s"),W]),u([i(53,"i64.load32_u"),W]),u([i(_.g$0,"i32.store"),W]),u([i(55,"i64.store"),W]),u([i(56,"f32.store"),W]),u([i(57,"f64.store"),W]),u([i(_.qHj,"i32.store8"),W]),u([i(59,"i32.store16"),W]),u([i(60,"i64.store8"),W]),u([i(61,"i64.store16"),W]),u([i(62,"i64.store32"),W]),u([i(63,"memory.size"),i(0,"memory.size")]),u([i(64,"memory.grow"),i(0,"memory.grow")]),u([i(252,"memory.init"),R(_.FZV),K,i(0,"memory.init")]),u([i(252,"data.drop"),R(_.VdM),K]),u([i(252,"memory.copy"),R(_.ARc),i(0,"memory.copy"),i(0,"memory.copy")]),u([i(252,"memory.fill"),R(_.aX5),i(0,"memory.fill")]),u([i(_.geW,"i32.const"),w]),u([i(66,"i64.const"),t=>{if(0===t.length)return{type:r.V8.ERROR,rest:t,error:["i64",t]};const e=[];let n=0;for(;n<t.length&&n<10;n++)if(e.push(t[n]),0==(128&t[n])){n++;break}if(0!=(128&e[e.length-1]))return{type:r.V8.ERROR,rest:t,error:["i64",t]};const s=o(new Uint8Array(e),!0);return{type:r.V8.RESULT,rest:new Uint8Array(t.buffer,t.byteOffset+n),result:{type:"i64",value:s}}}]),u([i(67,"f32.const"),t=>{if(t.length<4)return{type:r.V8.ERROR,rest:t,error:["f32",t]};const e=new DataView(t.buffer,t.byteOffset,4).getFloat32(0,!0);return{type:r.V8.RESULT,rest:new Uint8Array(t.buffer,t.byteOffset+4),result:{type:"f32",value:e}}}]),u([i(68,"f64.const"),t=>{if(t.length<8)return{type:r.V8.ERROR,rest:t,error:["f64",t]};const e=new DataView(t.buffer,t.byteOffset,8).getFloat64(0,!0);return{type:r.V8.RESULT,rest:new Uint8Array(t.buffer,t.byteOffset+8),result:{type:"f64",value:e}}}]),i(69,"i32.eqz"),i(70,"i32.eq"),i(71,"i32.ne"),i(72,"i32.lt_s"),i(73,"i32.lt_u"),i(74,"i32.gt_s"),i(75,"i32.gt_u"),i(76,"i32.le_s"),i(77,"i32.le_u"),i(78,"i32.ge_s"),i(79,"i32.ge_u"),i(80,"i64.eqz"),i(81,"i64.eq"),i(82,"i64.ne"),i(83,"i64.lt_s"),i(84,"i64.lt_u"),i(85,"i64.gt_s"),i(86,"i64.gt_u"),i(87,"i64.le_s"),i(88,"i64.le_u"),i(89,"i64.ge_s"),i(90,"i64.ge_u"),i(91,"f32.eq"),i(92,"f32.ne"),i(93,"f32.lt"),i(94,"f32.gt"),i(95,"f32.le"),i(96,"f32.ge"),i(97,"f64.eq"),i(98,"f64.ne"),i(99,"f64.lt"),i(100,"f64.gt"),i(101,"f64.le"),i(102,"f64.ge"),i(103,"i32.clz"),i(104,"i32.ctz"),i(105,"i32.popcnt"),i(_.mJg,"i32.add"),i(107,"i32.sub"),i(108,"i32.mul"),i(109,"i32.div_s"),i(110,"i32.div_u"),i(111,"i32.rem_s"),i(112,"i32.rem_u"),i(113,"i32.and"),i(114,"i32.or"),i(115,"i32.xor"),i(116,"i32.shl"),i(117,"i32.shr_s"),i(118,"i32.shr_u"),i(119,"i32.rotl"),i(120,"i32.rotr"),i(121,"i64.clz"),i(122,"i64.ctz"),i(123,"i64.popcnt"),i(124,"i64.add"),i(125,"i64.sub"),i(126,"i64.mul"),i(127,"i64.div_s"),i(128,"i64.div_u"),i(129,"i64.rem_s"),i(130,"i64.rem_u"),i(131,"i64.and"),i(132,"i64.or"),i(133,"i64.xor"),i(134,"i64.shl"),i(135,"i64.shr_s"),i(136,"i64.shr_u"),i(137,"i64.rotl"),i(138,"i64.rotr"),i(139,"f32.abs"),i(140,"f32.neg"),i(141,"f32.ceil"),i(142,"f32.floor"),i(143,"f32.trunc"),i(144,"f32.nearest"),i(145,"f32.sqrt"),i(146,"f32.add"),i(147,"f32.sub"),i(148,"f32.mul"),i(149,"f32.div"),i(150,"f32.min"),i(151,"f32.max"),i(152,"f32.copysign"),i(153,"f64.abs"),i(154,"f64.neg"),i(155,"f64.ceil"),i(156,"f64.floor"),i(157,"f64.trunc"),i(158,"f64.nearest"),i(159,"f64.sqrt"),i(160,"f64.add"),i(161,"f64.sub"),i(162,"f64.mul"),i(163,"f64.div"),i(164,"f64.min"),i(165,"f64.max"),i(166,"f64.copysign"),i(167,"i32.wrap_i64"),i(168,"i32.trunc_f32_s"),i(169,"i32.trunc_f32_u"),i(170,"i32.trunc_f64_s"),i(171,"i32.trunc_f64_u"),i(172,"i64.extend_i32_s"),i(173,"i64.extend_i32_u"),i(174,"i64.trunc_f32_s"),i(175,"i64.trunc_f32_u"),i(176,"i64.trunc_f64_s"),i(177,"i64.trunc_f64_u"),i(178,"f32.convert_i32_s"),i(179,"f32.convert_i32_u"),i(180,"f32.convert_i64_s"),i(181,"f32.convert_i64_u"),i(182,"f32.demote_f64"),i(183,"f64.convert_i32_s"),i(184,"f64.convert_i32_u"),i(185,"f64.convert_i64_s"),i(186,"f64.convert_i64_u"),i(187,"f64.promote_f32"),i(188,"i32.reinterpret_f32"),i(189,"i64.reinterpret_f64"),i(190,"f32.reinterpret_i32"),i(191,"f64.reinterpret_i64"),i(192,"i32.extend8_s"),i(193,"i32.extend16_s"),i(194,"i64.extend8_s"),i(195,"i64.extend16_s"),i(196,"i64.extend32_s"),u([i(252,"ixx.trunc_sat_fxx_su"),M]),u([i(253,"vector_instruction"),M,W])])),S=l("blocktype")([i(64,"empty-block-type"),x,w]);function $(t){return l("blockinst")([c((t=>{const e=t;return{opCode:e[0],data:{blockType:e[1],body:[...e[2],{opCode:_.D2H}]}}}))(u([i(_._oO,"block"),S,d(N),i(_.D2H,"end")])),c((t=>{const e=t;return{opCode:e[0],data:{blockType:e[1],body:[...e[2],{opCode:_.D2H}]}}}))(u([i(_.tNe,"loop"),S,d(N),i(_.D2H,"end")])),c((t=>{const e=t;return{opCode:e[0],data:{blockType:e[1],trueBody:[...e[2],{opCode:_.D2H}]}}}))(u([i(_.kJE,"if"),S,d(N),i(_.D2H,"end")])),c((t=>{const e=t;return{opCode:e[0],data:{blockType:e[1],trueBody:[...e[2],{opCode:5}],falseBody:[...e[4],{opCode:_.D2H}]}}}))(u([i(_.kJE,"if"),S,d(N),i(_.FUF,"else"),d(N),i(_.D2H,"end")]))])(t)}function N(t){return l("inst")([F,$])(t)}const V=c((t=>[...t[0],{opCode:_.D2H}]))(u([d(N),i(_.D2H,"end")])),G=(t,e,n)=>o=>{const s=u([i(t,"section-type"),T])(o);if(s.type===r.V8.ERROR)return s;const _=n(s.result[1]);return _.type===r.V8.ERROR?_:{type:r.V8.RESULT,rest:_.rest,result:{type:e,value:_.result}}},J=(G(0,"section-custom",u([A,T])),G(1,"section-type",P(L))),H=c((t=>({type:t[0],typeIdx:t[1]})))(l("importdesc")([u([i(r.VF.FUNC,"func"),K]),u([i(r.VF.GLOBAL,"table"),v]),u([i(r.VF.MEM,"mem"),B]),u([i(r.VF.GLOBAL,"global"),j])])),q=G(2,"section-import",P(c((t=>({type:"import",value:{module:t[0],name:t[1],type:t[2].type,typeIdx:t[2].typeIdx}})))(u([A,A,H])))),z=G(3,"section-func",P(K)),X=G(4,"section-table",P(v)),Z=G(5,"section-mem",P(B)),Y=G(6,"section-global",P(c((t=>({type:t[0][0],mut:1===t[0][1],expr:t[1]})))(u([j,V])))),Q=l("exportdesc")([u([i(0,"func"),K]),u([i(1,"table"),K]),u([i(2,"mem"),K]),u([i(3,"global"),K])]),tt=G(7,"section-export",P(c((t=>({name:t[0],type:t[1][0],idx:t[1][1]})))(u([A,Q])))),et=G(8,"section-start",K),nt=c((t=>{const e=[],n=t[0].value,o=t[1];for(let t=0;t<n;t++)e.push(o);return e}))(u([M,x])),ot=c((t=>({locals:t[0],body:t[1]})))(u([c((t=>t.flat()))(P(nt)),V]));var st;const _t=G(10,"section-code",P((st=ot,t=>e=>{const n=t(e);if(n.type===r.V8.ERROR)return n;const o=st(n.result);return o.type===r.V8.ERROR?{type:r.V8.ERROR,rest:n.rest,error:o.error}:{type:r.V8.RESULT,rest:n.rest,result:o.result}})(T))),at=G(11,"section-data",P(l("data-segment")([c((t=>{const e=t;return{type:"active",offsetExpr:e[1],data:e[2]}}))(u([R(0),V,T])),c((t=>({type:"passive",data:t[1]})))(u([R(1),T]))]))),rt=G(12,"section-data-count",M),ct=p([0,97,115,109]),it=p([1,0,0,0]),pt=c((t=>{const e=t.slice(2).filter((t=>null!==t)),n={type:"module",types:[],imports:[],funcs:[],tables:[],mems:[],globals:[],exports:[],start:-1,codes:[],datas:[]};return["section-type","section-import","section-func","section-table","section-mem","section-global","section-export","section-start","section-code","section-data"].forEach((t=>{const o=e.filter((e=>e.type===t));if(o.length>1)throw new Error(`expected exactly one section of type ${t}`);if(0===o.length)return;const s=o[0];if("section-start"===t)return void(n.start=s.value);if("section-type"===t)return void(n.types=s.value.map((t=>t.value)));if("section-import"===t)return void(n.imports=s.value.map((t=>t.value)));if("section-mem"===t)return void(n.mems=s.value.map((t=>t.value)));if("section-data"===t)return void(n.datas=s.value);const _=t.replace(/^section-/,"")+"s";n[_]=s.value})),n}))(u([ct,it,m(J),m(q),m(z),m(X),m(Z),m(Y),m(tt),m(et),m(rt),m(_t),m(at),t=>0===t.length?{type:r.V8.RESULT,rest:t,result:null}:{type:r.V8.ERROR,rest:t,error:[r.sd,t]}]))},769:(t,e,n)=>{var o;n.d(e,{V8:()=>o,VF:()=>_,sd:()=>s}),function(t){t.RESULT="result",t.ERROR="error"}(o||(o={}));const s="EOF";var _;!function(t){t[t.FUNC=0]="FUNC",t[t.TABLE=1]="TABLE",t[t.MEM=2]="MEM",t[t.GLOBAL=3]="GLOBAL"}(_||(_={}))}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var __webpack_exports__={};(()=>{var t=__webpack_require__(341);const e="the-output-elem",n=async n=>{console.log("setting up the AOT compiled BadGB demo");const o=document.querySelector("#"+e);o.innerHTML="",o.innerHTML='<div id="game">\n  <canvas width="160" height="144"></canvas>\n</div>\n<button id="load" class="capsuleBtn">Load</button>\n<div id="gp">\n  <div id="gp_dpad">\n    <div id="gp_left"></div>\n    <div id="gp_right"></div>\n    <div id="gp_up"></div>\n    <div id="gp_down"></div>\n  </div>\n  <div id="gp_select" class="capsuleBtn">Select</div>\n  <div id="gp_start" class="capsuleBtn">Start</div>\n  <div id="gp_b" class="roundBtn">B</div>\n  <div id="gp_a" class="roundBtn">A</div>\n</div>\n<input type="file" id="openfile" hidden>';{const t=document.createElement("style");t.innerHTML='/* mobile gamepad CSS and JS copied from\n    https://github.com/chrismaltby/gb-studio/blob/v2beta/appData/js-emulator/index.html\n    (see LICENSE.gbstudio)\n    */\n    body {\n      position: absolute;\n      display: flex;\n      flex-direction: column;\n      background-color: #eee;\n      margin: 0;\n      width: 100%;\n      height: 100%;\n      user-select: none;\n      -webkit-user-select: none;\n    }\n    \n    #game {\n      display: flex;\n      flex-direction: column;\n      position: absolute;\n      width: 100%;\n      height: 100%;\n      touch-action: none;\n      text-align: center;\n    }\n    \n    #load {\n      position: absolute;\n      top: 0;\n      right: 0;\n      color: white;\n      opacity: 0.5;\n    }\n    \n    canvas {\n      object-fit: contain;\n      image-rendering: pixelated;\n      image-rendering: crisp-edges;\n      height: 100%;\n    }\n    \n    #gp {\n      display: none;\n      position: fixed;\n      bottom: 0px;\n      height: 210px;\n      width: 100%;\n      touch-action: none;\n      opacity: 0.8;\n    }\n    \n    #gp_dpad {\n      position: absolute;\n      bottom: 20px;\n      left: 0px;\n      width: 184px;\n      height: 184px;\n    }\n    \n    #gp_dpad:before {\n      content: "";\n      display: block;\n      width: 48px;\n      height: 48px;\n      background: #5c5c5c;\n      background: radial-gradient(\n        ellipse at center,\n        #5c5c5c 0%,\n        #555 59%,\n        #5c5c5c 60%\n      );\n      position: absolute;\n      left: 68px;\n      top: 68px;\n    }\n    \n    #gp_left {\n      position: absolute;\n      left: 20px;\n      top: 68px;\n      width: 48px;\n      height: 48px;\n      background: #666;\n      background: radial-gradient(ellipse at center, #666 0%, #5c5c5c 80%);\n      border-top-left-radius: 4px;\n      border-bottom-left-radius: 4px;\n    }\n    \n    #gp_right {\n      position: absolute;\n      left: 116px;\n      top: 68px;\n      width: 48px;\n      height: 48px;\n      background: #666;\n      background: radial-gradient(ellipse at center, #666 0%, #5c5c5c 80%);\n      border-top-right-radius: 4px;\n      border-bottom-right-radius: 4px;\n    }\n    \n    #gp_up {\n      position: absolute;\n      left: 68px;\n      top: 20px;\n      width: 48px;\n      height: 48px;\n      background: #666;\n      background: radial-gradient(ellipse at center, #666 0%, #5c5c5c 80%);\n      border-top-left-radius: 4px;\n      border-top-right-radius: 4px;\n    }\n    \n    #gp_down {\n      position: absolute;\n      left: 68px;\n      top: 116px;\n      width: 48px;\n      height: 48px;\n      background: #666;\n      background: radial-gradient(ellipse at center, #666 0%, #5c5c5c 80%);\n      border-bottom-left-radius: 4px;\n      border-bottom-right-radius: 4px;\n    }\n    \n    #gp_a {\n      position: absolute;\n      bottom: 110px;\n      right: 20px;\n    }\n    \n    #gp_b {\n      position: absolute;\n      bottom: 80px;\n      right: 100px;\n    }\n    \n    .roundBtn {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      font-weight: bold;\n      font-size: 32px;\n      color: #440f1f;\n      line-height: 64px;\n      width: 64px;\n      height: 64px;\n      border-radius: 64px;\n      background: #870a4c;\n      background: radial-gradient(ellipse at center, #ab1465 0%, #8b1e57 100%);\n      box-shadow: 0px 4px 5px rgba(0, 0, 0, 0.2);\n    }\n    \n    .capsuleBtn {\n      font-weight: bold;\n      font-size: 10px;\n      color: #111;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      line-height: 40px;\n      text-transform: uppercase;\n      width: 64px;\n      height: 32px;\n      border-radius: 40px;\n      background: #222;\n      background: radial-gradient(ellipse at center, #666 0%, #555 100%);\n      box-shadow: 0px 4px 5px rgba(0, 0, 0, 0.2);\n    }\n    \n    #gp_start {\n      position: absolute;\n      bottom: 20px;\n      right: 15px;\n    }\n    \n    #gp_select {\n      position: absolute;\n      bottom: 20px;\n      right: 100px;\n    }\n    \n    .btnPressed {\n      opacity: 0.5;\n    }\n    \n    @media only screen and (max-width: 640px) {\n      #game canvas {\n        margin-top: 0px;\n        width: 100%;\n        max-width: 480px;\n        border: 0px;\n        border-radius: 0px;\n      }\n    }\n    \n    @media only screen and (max-device-width: 812px) and (orientation: portrait) {\n      body {\n        margin: 0;\n      }\n    \n      #game {\n        width: 100%;\n        position: fixed;\n        touch-action: none;\n      }\n    \n      #game canvas {\n        margin: 0;\n        display: block;\n        width: 100% !important;\n        height: auto !important;\n      }\n    }\n    \n    @media only screen and (max-device-width: 320px) and (orientation: portrait) {\n      #gp_dpad {\n        left: -5px;\n        bottom: -5px;\n      }\n    \n      #gp_a {\n        right: 5px;\n        bottom: 95px;\n      }\n    \n      #gp_b {\n        right: 80px;\n      }\n    \n      #gp_start {\n        right: 5px;\n      }\n    \n      #gp_select {\n        right: 80px;\n      }\n    }\n    \n    @media only screen and (max-width: 500px) and (max-height: 400px) {\n      #gp {\n        display: none;\n      }\n    }\n    \n    /* Small devices in landscape */\n    @media only screen and (max-device-width: 300px) and (orientation: landscape) {\n      html,\n      body {\n        height: 100%;\n      }\n      body {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n    \n      #game:after {\n        content: "PLEASE ROTATE ";\n        font-size: 24px;\n        font-weight: bold;\n        color: #fff;\n      }\n    \n      #game canvas {\n        display: none;\n        max-width: 480px;\n      }\n    \n      #gp {\n        display: none;\n      }\n    }\n    \n    /* Devices large enough for landscape */\n    @media only screen and (min-width: 300px) and (orientation: landscape) {\n      #gp {\n        bottom: 50%;\n        transform: translateY(50%);\n        opacity: 0.5;\n      }\n    }',o.appendChild(t)}const s=document.querySelector.bind(document),_=document.querySelector("canvas").getContext("2d"),a=_.createImageData(160,144);let r;s("#load").addEventListener("click",(()=>{s("#openfile").click()})),async function(){let e=await fetch("/assets/wasm/porklike.gb"),o=await e.arrayBuffer(),s=await(0,t.r9)(n,{});r=new i(s,o)}(),s("#openfile").addEventListener("change",(async e=>{let o=e.target.files[0];if(!o)return;r&&r.destroy();let s=await function(t){return new Promise(((e,n)=>{const o=new FileReader;o.onerror=t=>n(t.error),o.onloadend=t=>e(t.target.result),o.readAsArrayBuffer(t)}))}(o),_=await(0,t.r9)(n,{});r=new i(_,s)}));let c=null;class i{constructor(t,e){this.exports=t.exports;const n=this.exports.mem.buffer;this.canvasData=new Uint8Array(n,1146880,92160);const o=new Uint8Array(n,65536,1<<20);this.extram=new Uint8Array(n,1114112,32768),o.set(new Uint8Array(e)),this.keys=new Uint8Array(n,12,4),this.bindings=[{sel:"",type:"keydown",fn:this.onKey.bind(this,!0)},{sel:"",type:"keyup",fn:this.onKey.bind(this,!1)},{sel:"#gp_select",type:"touchstart",fn:this.btnTouch.bind(this,2,1,!0)},{sel:"#gp_select",type:"touchend",fn:this.btnTouch.bind(this,2,1,!1)},{sel:"#gp_start",type:"touchstart",fn:this.btnTouch.bind(this,3,1,!0)},{sel:"#gp_start",type:"touchend",fn:this.btnTouch.bind(this,3,1,!1)},{sel:"#gp_b",type:"touchstart",fn:this.btnTouch.bind(this,1,1,!0)},{sel:"#gp_b",type:"touchend",fn:this.btnTouch.bind(this,1,1,!1)},{sel:"#gp_a",type:"touchstart",fn:this.btnTouch.bind(this,0,1,!0)},{sel:"#gp_a",type:"touchend",fn:this.btnTouch.bind(this,0,1,!1)},{sel:"#gp_dpad",type:"touchstart",fn:this.dpadTouchStartMove.bind(this)},{sel:"#gp_dpad",type:"touchmove",fn:this.dpadTouchStartMove.bind(this)},{sel:"#gp_dpad",type:"touchend",fn:this.dpadTouchEnd.bind(this)},{sel:"",type:"touchstart",fn:this.touchRestore.bind(this)}],this.updateBinding(!0),this.touchEnabled="ontouchstart"in document.documentElement,this.updateOnscreenGamepad(),this.extramIntervalId=-1,crypto.subtle.digest("sha-1",e).then((t=>{this.sha1=Array.from(new Uint8Array(t)).map((t=>t.toString(16).padStart(2,"0"))).join("");const e=localStorage.getItem(this.sha1);e&&this.extram.set(JSON.parse(e)),this.extramIntervalId=setInterval((()=>{localStorage.setItem(this.sha1,JSON.stringify(Array.from(this.extram)))}),1e3)})).finally((()=>{this.running=!0,this.update()}))}destroy(){clearInterval(this.extramIntervalId),this.running=!1,this.updateBinding(!1)}updateBinding(t){for(let e of this.bindings){const n=e.sel?s(e.sel):window;t?n.addEventListener(e.type,e.fn):n.removeEventListener(e.type,e.fn)}}setKey(t,e,n){const o=1<<t,s=~(n?o:0),_=t=>this.keys[t]=(this.keys[t]|o)&s;_(e?2:1),_(3)}setJoypRight(t){this.setKey(0,0,t)}setJoypLeft(t){this.setKey(1,0,t)}setJoypUp(t){this.setKey(2,0,t)}setJoypDown(t){this.setKey(3,0,t)}setJoypA(t){this.setKey(0,1,t)}setJoypB(t){this.setKey(1,1,t)}setJoypSelect(t){this.setKey(2,1,t)}setJoypStart(t){this.setKey(3,1,t)}onKey(t,e){switch(e.code){case"ArrowDown":this.setJoypDown(t);break;case"ArrowUp":this.setJoypUp(t);break;case"ArrowLeft":this.setJoypLeft(t);break;case"ArrowRight":this.setJoypRight(t);break;case"Enter":this.setJoypStart(t);break;case"Tab":this.setJoypSelect(t);break;case"KeyZ":this.setJoypB(t);break;case"KeyX":this.setJoypA(t)}t&&this.touchEnabled&&(this.touchEnabled=!1,this.updateOnscreenGamepad()),e.preventDefault()}update(){if(!c){this.running&&requestAnimationFrame(this.update.bind(this));try{this.exports.run()}catch(t){console.error("failed to error:",t),c=t}a.data.set(this.canvasData),_.putImageData(a,0,0)}}updateOnscreenGamepad(){s("#gp").style.display=this.touchEnabled?"block":"none"}btnTouch(t,e,n){this.setKey(t,e,n),event.currentTarget.classList.toggle("btnPressed",n),event.preventDefault()}dpadTouchStartMove(t){const e=t.currentTarget.getBoundingClientRect(),n=2*(t.targetTouches[0].clientX-e.left)/e.width-1,o=2*(t.targetTouches[0].clientY-e.top)/e.height-1;Math.abs(n)>.1?o>n&&o<-n?(this.setJoypLeft(!0),this.setJoypRight(!1)):o<n&&o>-n&&(this.setJoypLeft(!1),this.setJoypRight(!0)):(this.setJoypLeft(!1),this.setJoypRight(!1)),Math.abs(o)>.1?n>o&&n<-o?(this.setJoypUp(!0),this.setJoypDown(!1)):n<o&&n>-o&&(this.setJoypUp(!1),this.setJoypDown(!0)):(this.setJoypUp(!1),this.setJoypDown(!1)),t.preventDefault()}dpadTouchEnd(t){this.setJoypLeft(!1),this.setJoypRight(!1),this.setJoypUp(!1),this.setJoypDown(!1),t.preventDefault()}touchRestore(){this.touchEnabled=!0,this.updateOnscreenGamepad()}}},o=()=>{console.log("setup start");const o=document.createElement("select");["---","no-start","test-add-vec2","add","fib","metaball","jit","quine","snake","dino","fire","chip8","ray","inflate","mod","maze","match3","badgb"].forEach((t=>{const e=document.createElement("option");e.setAttribute("value",t),e.textContent=t,o.appendChild(e)})),o.addEventListener("change",(async o=>{const s=o.target.value;if("---"===s)return;const _=`${window.location.pathname}assets/wasm/${s}.wasm`;console.log(_);const a=await fetch(_);if(!a.ok)throw new Error("failed to fetch");const r=new Uint8Array(await a.arrayBuffer());console.log("wasm module bytes:",r);const c=await(0,t.PF)(r,!1);if(console.log("myAotCompiledJSCode:"),console.log(c),"fire"===s)return await(async n=>{console.log("setting up the AOT compiled fire demo");const o=document.querySelector("#"+e);o.innerHTML="";const s=document.createElement("canvas");s.width=320,s.height=168,o.appendChild(s);{const t=document.createElement("style");t.innerHTML="body {\n            position: absolute;\n            display: flex;\n            flex-direction: column;\n            justify-content: flex-end;\n            background-color: #070707;\n            margin: 0;\n            width: 100%;\n            height: 100%;\n          }\n          canvas {\n            width: 100vw;\n            height: 52.5vw;\n          }",o.appendChild(t)}const _={"":{rand:Math.random}},a=await(0,t.r9)(n,_);if(console.log("fire instance",a),!(a.exports.mem instanceof Uint8Array))throw new Error('expected an export called "mem" of type Uint8Array');const r=new Uint8Array(a.exports.mem.buffer,53760,215040),c=s.getContext("2d");c.fillStyle="black",c.fillRect(0,0,320,168);const i=c.createImageData(320,168);let p=!1;const l=()=>{requestAnimationFrame(l),p||(p=!0,a.exports.run(),i.data.set(r),c.putImageData(i,0,0),p=!1)};l()})(c);if("test-add-vec2"===s)return await(async n=>{console.log("setting up the AOT compiled test addvec2 demo");const o=document.querySelector("#"+e);o.innerHTML="";const s=document.createElement("pre");o.appendChild(s);const _={console:{log:t=>{""===s.textContent?s.textContent=`${t}`:s.textContent+=`\n${t}`}}},a=await(0,t.r9)(n,_);console.log("test addvec2 instance",a)})(c);if("fib"===s)return await(async n=>{console.log("setting up the AOT compiled fibonacci demo");const o=document.querySelector("#"+e);o.innerHTML="";const s={console:{log:console.log}},_=await(0,t.r9)(n,s);console.log("fibonacci instance",_);const a=_.exports.fib(10);o.textContent=`fibonacci(10) = ${a}`})(c);if("dino"===s)return await(async n=>{console.log("setting up the AOT compiled dino demo");const o=document.querySelector("#"+e);o.innerHTML="";const s=document.createElement("canvas");s.width=300,s.height=75,o.appendChild(s);{const t=document.createElement("style");t.innerHTML="body {\n            position: absolute;\n            display: flex;\n            flex-direction: column;\n            background-color: #fff;\n            margin: 0;\n            width: 100%;\n            height: 100%;\n          }\n          canvas {\n            object-fit: contain;\n            width: 100%;\n            height: 100%;\n            image-rendering: pixelated;\n            image-rendering: crisp-edges;\n          }",o.appendChild(t)}const _={Math},a=await(0,t.r9)(n,_);console.log("AOT dino instance",a);const r=new Uint8Array(a.exports.mem.buffer,20480,9e4),c=s.getContext("2d"),i=c.createImageData(300,75),p=new Uint8Array(a.exports.mem.buffer,0,4),l=(t,e)=>{let n;switch(e.code){case"ArrowUp":n=1;break;case"ArrowDown":n=2;break;default:return}t?p[0]|=n:p[0]&=~n};document.addEventListener("keydown",l.bind(null,1),!1),document.addEventListener("keyup",l.bind(null,0),!1);let u=null;console.log("done setting up the dino demo"),function t(){if(!u){requestAnimationFrame(t);try{a.exports.run()}catch(t){console.error("failed to update. error:",t),u=t}i.data.set(r),c.putImageData(i,0,0)}}()})(c);if("snake"===s)return await(async n=>{console.log("setting up the AOT compiled snake demo");const o=document.querySelector("#"+e);o.innerHTML="";const s=document.createElement("canvas");s.width=240,s.height=320,o.appendChild(s);{const t=document.createElement("style");t.innerHTML="body {\n      position: absolute;\n      display: flex;\n      flex-direction: column;\n      background-color: #555;\n      margin: 0;\n      width: 100%;\n      height: 100%;\n    }\n    canvas {\n      object-fit: contain;\n      width: 100%;\n      height: 100%;\n    }",o.appendChild(t)}const _={Math},a=await(0,t.r9)(n,_);console.log("AOT snake instance",a);const r=new Uint8Array(a.exports.mem.buffer,86016,307200),c=s.getContext("2d"),i=c.createImageData(240,320),p=new Uint8Array(a.exports.mem.buffer,704,2);let l=(t,e)=>{switch(e.code){default:case"ArrowLeft":p[0]=t;break;case"ArrowRight":p[1]=t}};document.addEventListener("keydown",l.bind(null,1),!1),document.addEventListener("keyup",l.bind(null,0),!1),function t(){requestAnimationFrame(t),a.exports.run(),i.data.set(r),c.putImageData(i,0,0)}()})(c);if("metaball"===s)return await(async n=>{console.log("setting up the AOT compiled snake demo");const o=document.querySelector("#"+e);o.innerHTML="";const s=document.createElement("canvas");s.width=320,s.height=200,o.appendChild(s);{const t=document.createElement("style");t.innerHTML="body {\n        position: absolute;\n        display: flex;\n        flex-direction: column;\n        background-color: #d4195d;\n        margin: 0;\n        width: 100%;\n        height: 100%;\n      }\n      canvas {\n        object-fit: cover;\n        width: 100%;\n        height: 100%;\n      }",o.appendChild(t)}let _=0|Math.min(Math.max(window.outerWidth/80,4),10),a=null;document.body.addEventListener("click",(()=>a&&a(_)),!0);const r={"":{rand:Math.random}},c=await(0,t.r9)(n,r);console.log("AOT metaball instance",c),a=c.exports.blobs,a(_);const i=new Uint8Array(c.exports.mem.buffer,1024,256e3),p=s.getContext("2d"),l=p.createImageData(320,200);!function t(){requestAnimationFrame(t),c.exports.run(),l.data.set(i),p.putImageData(l,0,0)}()})(c);if("maze"===s)return await(async n=>{console.log("setting up the AOT compiled maze demo");const o=document.querySelector("#"+e);o.innerHTML="";const s=document.createElement("span");s.textContent="0.0 / 0.0",s.classList.add("timer"),o.appendChild(s);const _=document.createElement("canvas");_.width=320,_.height=240,o.appendChild(_);{const t=document.createElement("style");t.innerHTML="body {\n      position: absolute;\n      display: flex;\n      flex-direction: column;\n      background-color: #555;\n      margin: 0;\n      width: 100%;\n      height: 100%;\n    }\n    canvas {\n      object-fit: contain;\n      width: 100%;\n      height: 100%;\n    }\n    .timer {\n      position: absolute;\n      top: 0;\n      right: 0;\n      font-size: xx-large;\n      background-color: #0000009c;\n      color: white;\n      text-shadow: 1px 1px 2px black;\n      width: fit-content;\n      padding: 8px;\n      margin: 8px;\n      font-variant-numeric: tabular-nums;\n    }",o.appendChild(t)}let a=!1,r=0,c=1/0;const i=()=>+new Date;let p={t:t=>{if(t)r=i();else{let t=i()-r;t<c&&(c=t),r=t}a=t}};setInterval((()=>{const t=t=>t==1/0?"":(t/1e3).toFixed(2);let e=document.querySelector(".timer"),n=a?i()-r:r;e.textContent=`${t(n)} / ${t(c)}`}),100);const l={Math,env:p},u=await(0,t.r9)(n,l);let d=new Uint8Array(u.exports.mem.buffer,12288,307200),m=_.getContext("2d"),h=m.createImageData(320,240),E=new Uint8Array(u.exports.mem.buffer,0,4),f=(t,e)=>{switch(e.code){case"ArrowLeft":E[0]=t;break;case"ArrowRight":E[1]=t;break;case"ArrowUp":E[2]=t;break;case"ArrowDown":E[3]=t}};document.addEventListener("keydown",f.bind(null,1),!1),document.addEventListener("keyup",f.bind(null,0),!1),function t(){requestAnimationFrame(t),u.exports.run(),h.data.set(d),m.putImageData(h,0,0)}()})(c);if("mod"===s)return await(async t=>{console.log("setting up the AOT compiled mod demo");const n=document.querySelector("#"+e);n.innerHTML="",n.innerHTML='<div class="body-wrapper">\n  <div class="controls-wrapper bborder">\n    <div>All files hosted by <a href="https://modarchive.org">modarchive.org</a>, chosen from recent featured tracks and requests</div>\n    <div class="config">\n      <div class="controls">\n        <select id="select">\n        </select>\n        <button id="play">play</button>\n        <label class="volume-label"><span id="volume-text">volume</span><input type="range" id="volume" min="0" max="100" value="30"></label>\n        <label><span id="mono-text">mono</span><input type="checkbox" id="mono"></label>\n      </div>\n      <table>\n        <tr>\n          <th>song</th>\n          <td id="song"></td>\n        </tr>\n        <tr>\n          <th>pattern</th>\n          <td id="pattern">0</td>\n        </tr>\n      </table>\n    </div>\n  </div>\n  <div class="info-wrapper bborder">\n    <div class="info">\n      <table></table>\n    </div>\n  </div>\n  <div class="track-wrapper">\n    <table class="track">\n    </table>\n  </div>\n</div>';{const t=document.createElement("style");t.innerHTML="body {\n      position: absolute;\n      margin: 0;\n      width: 100%;\n      height: 100%;\n      user-select: none;\n      -webkit-user-select: none;\n      font: 8pt monospace;\n    }\n    .body-wrapper {\n      box-sizing: border-box;\n      display: flex;\n      background-color: #eee;\n      flex-direction: column;\n      margin: 0 auto;\n      max-width: 800px;\n      width: 100%;\n      height: 100%;\n      padding: 10px;\n    }\n    .bborder {\n      padding-bottom: 0.5em;\n      margin-bottom: 0.5em;\n      border-bottom: 1px solid #999;\n    }\n    .info-wrapper {\n      flex: 1;\n      overflow: auto;\n    }\n    .info table {\n      table-layout: fixed;\n      width: 100%;\n    }\n    .info table td {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n    .track-wrapper {\n      flex: 3;\n      overflow: auto;\n    }\n    .track {\n      width: 100%;\n      height: 100%;\n    }\n    .track thead th {\n      top: 0;\n      position: sticky;\n      background: #eee;\n    }\n    .cell {\n      display: flex;\n      flex-direction: row;\n      white-space: nowrap;\n      overflow: hidden;\n      justify-content: center;\n    }\n    .note { width: 2rem; }\n    .ins { width: 1rem; }\n    .fx { width: 2rem; }\n    .hl { background-color: #777; color: white; }\n    .controls {\n      display: flex;\n      flex-direction: row;\n      flex-wrap: wrap;\n    }\n    .controls > * { margin: 0 2px; }\n    .volume-label { flex: 1; display: flex; flex-direction: row; }\n    #volume-text { align-self: center; }\n    #volume { flex: 1; }\n    #mono-text { vertical-align: middle; }\n    #mono { vertical-align: middle; }",n.appendChild(t)}const o=document.querySelector.bind(document),s=o("#play"),_=o("#select"),a=o("#volume"),r=o("#mono"),c=new AudioContext,i=c.createGain();i.gain.setValueAtTime(a.value/100,c.currentTime);let p,l,u=0,d=!1,m=!1,h=0,E=0,f=[],I=async function(){await c.audioWorklet.addModule(`${window.location.pathname}assets/demo/mod/worklet.js`);const e=t;l=new AudioWorkletNode(c,"player",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2],processorOptions:{sampleRate:c.sampleRate,module:e}}),l.port.onmessage=t=>{switch(t.data.msg){case"init":!function(t){const e=new TextDecoder;function n(t,n){const o=new Uint8Array(p.buffer,t,n);return e.decode(o).replace(/\0*$/,"")}u=t,document.querySelector("#song").textContent=n(0,20);const o=document.querySelector(".info table");o.innerHTML="";const s=Math.ceil(15.5);for(let t=0;t<s;++t){const e=document.createElement("tr");for(let o=0;o<2;++o){const _=o*s+t;if(_<31){const t=n(20+30*_,22),o=document.createElement("td");o.innerHTML=`<b>${_}</b> ${t}`,e.appendChild(o)}}o.appendChild(e)}const _=document.querySelector(".track");_.innerHTML="";{const t=document.createElement("thead");let e=document.createElement("th");e.textContent="row",t.appendChild(e);for(let e=0;e<u;++e){const n=document.createElement("th");n.textContent=`ch${e+1}`,t.appendChild(n)}_.appendChild(t)}f=[];{const t=document.createElement("tbody");for(let e=0;e<64;++e){const n=document.createElement("tr"),o=document.createElement("th");o.textContent=`${e}`,n.appendChild(o),n.classList.add(`row${e}`);const s=[];for(let t=0;t<u;++t){const o=document.createElement("td"),_=document.createElement("div");_.classList.add("cell",`ch${t}`,`row${e}`);const a=document.createElement("div");a.classList.add("note"),a.textContent="C-2";const r=document.createElement("div");r.classList.add("ins"),r.textContent="00";const c=document.createElement("div");c.classList.add("fx"),c.textContent="C20",_.appendChild(a),_.appendChild(r),_.appendChild(c),o.appendChild(_),n.appendChild(o),s.push({div:_,note:a,ins:r,fx:c})}t.appendChild(n),f.push(s)}_.appendChild(t)}}(t.data.channels);break;case"draw":e=t.data.pattern,n=t.data.row,function(t){document.querySelector("#pattern").textContent=`${t}`,h=t;let e=1084+64*p.getUint8(952+t)*u*4;for(let t=0;t<64;++t)for(let n=0;n<u;++n){const o=(15&p.getUint8(e))<<8|p.getUint8(e+1),s=p.getUint8(e+2)>>4|16&p.getUint8(e),_=15&p.getUint8(e+2),a=p.getUint8(e+3),r=f[t][n],c=r.note,i=r.ins,l=r.fx;c.textContent=k[o],i.textContent=s?D(s):"-",l.textContent=_||a?`${y(_)}${D(a)}`:"---",e+=4}}(e),function(t){for(let e=0;e<u;++e)f[E][e].div.classList.remove("hl"),f[t][e].div.classList.add("hl");E=t,f[t][0].div.scrollIntoView({block:"center"})}(n)}var e,n}}();async function g(t){s.textContent="loading...",s.disabled=!0;try{let[e,n]=await Promise.all([I,await fetch(t)]);const o=await n.arrayBuffer();console.log("load - file:",o),p=new DataView(o),l.port.postMessage({msg:"load",file:o}),s.disabled=!1}finally{s.textContent="play"}}const b=["https://api.modarchive.org/downloads.php?moduleid=199742#mygg_josss_bonefish_-_turn_it_up.mod","https://api.modarchive.org/downloads.php?moduleid=199739#kefka_-_amazinggrejs.mod","https://api.modarchive.org/downloads.php?moduleid=199609#saxxonpike_-_dusk_ritual.mod","https://api.modarchive.org/downloads.php?moduleid=199607#manwe-mainspring.mod","https://api.modarchive.org/downloads.php?moduleid=199505#esau_-_3d-demo-2013.mod","https://api.modarchive.org/downloads.php?moduleid=199356#fluid_freak.mod","https://api.modarchive.org/downloads.php?moduleid=199345#generation_compoed.mod","https://api.modarchive.org/downloads.php?moduleid=199342#hot_dots.mod","https://api.modarchive.org/downloads.php?moduleid=199330#optimal_workflow.mod","https://api.modarchive.org/downloads.php?moduleid=199324#freerunner.mod","https://api.modarchive.org/downloads.php?moduleid=199193#tero_risti_-_social_engineering.mod","https://api.modarchive.org/downloads.php?moduleid=199122#at_the_sunrise.mod","https://api.modarchive.org/downloads.php?moduleid=198232#adkd_-_message_of_surabhi.mod","https://api.modarchive.org/downloads.php?moduleid=198223#richard_horvath-a_new_beginning.mod","https://api.modarchive.org/downloads.php?moduleid=198041#h0ffman_-_technova.mod","https://api.modarchive.org/downloads.php?moduleid=198040#mrs_beanbag_-_its_a_holiday.mod","https://api.modarchive.org/downloads.php?moduleid=197982#conqueror_of_virgins.mod","https://api.modarchive.org/downloads.php?moduleid=197870#bombastic-968.mod","https://api.modarchive.org/downloads.php?moduleid=197758#gmz.mod","https://api.modarchive.org/downloads.php?moduleid=197709#josss_-_khromical_science.mod","https://api.modarchive.org/downloads.php?moduleid=197707#josss_-_greased_machine.mod","https://api.modarchive.org/downloads.php?moduleid=197706#josss_-_sunny_soul.mod","https://api.modarchive.org/downloads.php?moduleid=197703#josss_-_churrasco.mod","https://api.modarchive.org/downloads.php?moduleid=197403#etro.mod","https://api.modarchive.org/downloads.php?moduleid=197293#uprough-15_years_of_fame.mod","https://api.modarchive.org/downloads.php?moduleid=197218#alpha_flight_-_hard.mod","https://api.modarchive.org/downloads.php?moduleid=197203#szudi_-_prestige.mod","https://api.modarchive.org/downloads.php?moduleid=191474#bonefish_and_mygg_-_brofists.mod","https://api.modarchive.org/downloads.php?moduleid=42919#garbage.mod"];g(b[0]);for(let t=0;t<b.length;++t){const e=document.createElement("option");0===t&&(e.selected=!0);let n=b[t].indexOf("#");e.textContent=b[t].slice(n+1),e.value=`${t}`,_.appendChild(e)}function O(t){m=t,l.port.postMessage({msg:"play",value:m}),s.textContent=m?"pause":"play"}s.addEventListener("click",(async()=>{d||(d=!0,await c.resume(),l.connect(i),i.connect(c.destination)),O(!m)})),_.addEventListener("change",(t=>{O(!1),g(b[t.target.value])})),a.addEventListener("input",(t=>{i.gain.setValueAtTime(t.target.value/100,c.currentTime)})),r.addEventListener("change",(t=>{i.disconnect(),c.destination.channelCount=t.target.checked?1:2,i.connect(c.destination)}));const k={0:"",856:"C-1 ",808:"C#-1",762:"D-1 ",720:"D#-1",678:"E-1 ",640:"F-1 ",604:"F#-1",570:"G-1 ",538:"G#-1",508:"A-1 ",480:"A#-1",453:"B-1 ",428:"C-2 ",404:"C#-2",381:"D-2 ",360:"D#-2",339:"E-2 ",320:"F-2 ",302:"F#-2",285:"G-2 ",269:"G#-2",254:"A-2 ",240:"A#-2",226:"B-2 ",214:"C-3 ",202:"C#-3",190:"D-3 ",180:"D#-3",170:"E-3 ",160:"F-3 ",151:"F#-3",143:"G-3 ",135:"G#-3",127:"A-3 ",120:"A#-3",113:"B-3 "},y=t=>t.toString(16).toUpperCase(),D=t=>y(t).padStart(2,"0")})(c);if("ray"===s)return await(async n=>{console.log("setting up the AOT compiled ray demo");const o=document.querySelector("#"+e);o.innerHTML="",o.innerHTML='<canvas width="320" height="200"></canvas>';{const t=document.createElement("style");t.innerHTML="body {\n      position: absolute;\n      display: flex;\n      flex-direction: column;\n      background-color: #ccc;\n      margin: 0;\n      width: 100%;\n      height: 100%;\n    }\n    canvas {\n      object-fit: cover;\n      width: 100%;\n      height: 100%;\n    }\n    .ui-wrap {\n      position: absolute;\n      display: flex;\n      flex-direction: column;\n      background-color: rgba(255, 255, 255, 0.25);\n      width: 30%;\n      height: 100%;\n      overflow-x: hidden;\n      overflow-y: scroll;\n\n      display: none;\n    }\n    .ui {\n      padding: 1em;\n      margin: auto;\n    }\n    .value {\n      min-width: 4em;\n    }",o.appendChild(t)}let s;const _={Math},a=await(0,t.r9)(n,_);let r=new Uint8Array(a.exports.mem.buffer,1024,256e3),c=document.querySelector("canvas").getContext("2d"),i=c.createImageData(320,200);s=a.exports.mem,setTimeout((()=>{let t=[["x.a",-10,10,.1],["x.b",-3,3,.01],["x.c",0,2*Math.PI,.1],["x.d",-10,10,.1],["y.a",-10,10,.1],["y.b",-3,3,.01],["y.c",0,2*Math.PI,.1],["y.d",-20,10,.1],["z.a",-10,10,.1],["z.b",-3,3,.01],["z.c",0,2*Math.PI,.1],["z.d",-30,-5,.1],["r.a",-3,3,.1],["r.b",-3,3,.01],["r.c",0,2*Math.PI,.1],["r.d",0,5,.1],["R.a",0,1,.01],["R.b",-3,3,.01],["R.c",0,2*Math.PI,.1],["R.d",0,1,.01],["G.a",0,1,.01],["G.b",-3,3,.01],["G.c",0,2*Math.PI,.1],["G.d",0,1,.01],["B.a",0,1,.01],["B.b",-3,3,.01],["B.c",0,2*Math.PI,.1],["B.d",0,1,.01]],e=[{},{},{}],n=new window.dat.GUI;!function t(e){requestAnimationFrame(t),a.exports.run(e),i.data.set(r),c.putImageData(i,0,0)}(0),function(){for(let o=0;o<3;++o){let _=n.addFolder(`sphere ${o}`),a=new Float32Array(s.buffer,124+16*o*7,112);for(let n=0;n<t.length;++n){let[s,r,c,i]=t[n];e[o][s]=a[n],_.add(e[o],s,r,c,i).onChange((t=>{a[n]=t}))}}}()}),10)})(c);if("match3"===s)return await(async n=>{console.log("setting up the AOT compiled match 3 demo");const o=document.querySelector("#"+e);o.innerHTML="";const s=document.createElement("canvas");s.width=150,s.height=150,o.appendChild(s);{const t=document.createElement("style");t.innerHTML="body {\n        position: absolute;\n        display: flex;\n        flex-direction: column;\n        background-color: #fff;\n        margin: 0;\n        width: 100%;\n        height: 100%;\n      }\n      canvas {\n        object-fit: contain;\n        width: 100%;\n        height: 100%;\n        image-rendering: pixelated;\n        image-rendering: crisp-edges;\n      }",o.appendChild(t)}const _={Math:{random:Math.random}},a=await(0,t.r9)(n,_);if(console.log("match 3 instance",a),!(a.exports.mem instanceof Uint8Array))throw new Error('expected an export called "mem" of type Uint8Array');const r=150,c=150,i=s.getContext("2d"),p=i.createImageData(r,c);function l(t,e,n){return Math.min(Math.max(e,t),n)}const u=a.exports,d=new Uint8Array(u.mem.buffer,0,3),m=new Uint8Array(u.mem.buffer,4352,9e4);function h(t){let[e,n]=function(t){const e=t.target,n=e.clientWidth,o=e.clientHeight;let s,_,a;n<o?(s=n,_=0,a=(o-n)/2):(s=o,_=(n-o)/2,a=0);let i=t.clientX-e.offsetLeft,p=t.clientY-e.offsetTop;return[l(0,r*(i-_)/s,149),l(0,c*(p-a)/s,149)]}(t);d[0]=e,d[1]=n,d[2]=t.buttons}s.addEventListener("mousemove",h),s.addEventListener("mousedown",h),s.addEventListener("mouseup",h);let E=!1;!function t(){requestAnimationFrame(t),E||(E=!0,u.run(),p.data.set(m),i.putImageData(p,0,0),E=!1)}()})(c);if("badgb"===s)return await n(c);throw new Error(`unsupported demo: ${s}`)}));const s=document.createElement("div");s.classList.add("controls"),s.appendChild(o);const _=document.createElement("div");_.id=e,_.classList.add("output");const a=document.querySelector("#root");a.appendChild(s),a.appendChild(_),console.log("setup end")};(async()=>{window&&window.WASM2JS_DEMO_MODE&&(console.log("main start"),o(),console.log("main end"))})().catch(console.error)})()})();